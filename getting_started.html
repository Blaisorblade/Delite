<html>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
    <title>Delite &mdash; Getting started</title>
    <style type='text/css'>
      @import 'css/default.css';
      @import 'css/syntax.css';
    </style>
    <style media='print' type='text/css'>
      @import 'css/print.css';
    </style>
    <meta content='Delite documentation' name='subject'>
    <!-- <link href='images/favicon.png' rel='shortcut icon'> -->
  </head>
  <body>
    <div id='outer'>
      <div id='header'>
        <div class='home'><a href='http://stanford-ppl.github.com/Delite/' title="Delite">Delite</a></div>
      </div>
      <div id='menu'>
        <ol>
          <li>Start Here
            <ol>
              <li><a href='index.html'>Welcome</a></li>
              <li><a href='getting_started.html'>Getting Started</a></li>
              <li><a href="dsl_example.html">My First DSL</a></li>
              <li><a href="performance.html">Performance</a></li>
              <li><a href="tests.html">Tests</a></li>
              <li><a href="troubleshooting.html">Troubleshooting</a></li>
              <li><a href="publications.html">Publications</a></li>
            </ol>
          </li>
          <li>Getting it
            <ol>
            <!--
              <li><a href='releases.html'>Releases</a></li>
              <li><a href='snapshots.html'>Snapshots</a></li>
            -->
              <li><a href='source.html'>Source</a></li>
              <li><a href='license.html'>License</a></li>
            </ol>
          </li>
          <!--
          <li>Reference
            <ol>
              <li><a href='api/0.3/index.html'>ScalaDoc API</a></li>
              <li>&nbsp;</li>
              <li><a href='sponsors.html'>Sponsors</a></li>
              <li class="logo"><a href="http://ppl.stanford.edu"><img width="110" alt="Stanford Pervasive Parallelism Lab" src='images/ppl_logo_small.png'></a></li>
            </ol>
          </li>
          -->
        </ol>
      </div>
      <div id='content'> 
        <h1 id='title_getting started'>Getting started</h1>
        <p> To get started, grab the source for <code>Delite</code> and <code>virtualization-lms-core</code>, the lightweight modular
        staging library that Delite uses. Delite uses <a href="http://git-scm.com/">git</a> for version control. Instructions on how
        to install git can be found here: <a href="http://book.git-scm.com/2_installing_git.html">http://book.git-scm.com/2_installing_git.html</a>.
        </p><p>
        <div class="highlight"><pre><code class="bash">git clone https://github.com/stanford-ppl/Delite.git
git clone https://github.com/TiarkRompf/virtualization-lms-core.git</code></pre></div> <p>You will also need to switch to the right LMS branch, from the root of the LMS repository: </p> 
        <div class="highlight"><pre><code class="bash">cd virtualization-lms-core
git checkout delite-develop</code></pre></div>
        
        <p> The Delite repository currently includes several modules: </p>
        <ol>
          <li> <b>Applications:</b> these are example Delite applications written in a Delite DSL
          <li> <b>DSLs:</b> prototype Delite DSLs (the main one right now is OptiML)
          <li> <b>Framework:</b> The Delite Compiler Framework
          <li> <b>Runtime:</b> The Delite Runtime
          <li> <b>Tests:</b> tests for all Delite modules
        </ol>

        <p> For now, we'll get you up and running simple applications in the Delite environment so you can see what's going on.
        If you are using IDEA, make sure that you have the <code>framework</code>, <code>dsls</code>, and
        <code>virtualization-lms-core</code> modules in your classpath. Also make sure that you are using
        the <code>scala-virtualized</code> compiler. The rest of this guide will assume a UNIX environment and
        use SBT and our shell scripts, but as long as IDEA is configured correctly, you should be able to follow along.
        See <a href="source.html">here</a> for detailed IDEA build instructions.
        </p>
        <p> SBT setup:
        We use <a href="http://code.google.com/p/simple-build-tool/wiki/Setup">sbt</a> to build our repositories. If you don't
        have it installed already, download and install it by following the linked setup guide. Our repositories are tested
        with version 0.7.4 of sbt. You may also need to modify the sbt startup script to increase the available JVM
        memory. An example script (the 'sbt' file in your ~/bin directory) that we have found to work is:
        </p><p>
        <div class="highlight" style="overflow: scroll"><pre><code class="bash">java -Xmx1g -XX:MaxPermSize=512m -XX:ReservedCodeCacheSize=128m -jar `dirname $0`/sbt-launch.jar "$@"</pre></code></div>
        </p>
        <p>If you haven't already, we need to compile Delite. We'll assume that the root directory
        of the Delite and LMS distributions you downloaded are <code>$DELITE</code> and <code>$LMS</code> respectively. 
        To follow the rest of these instructions, it is easiest if you set these locations explicitly. In BASH,
        this can be done as follows: </p>
        <div class="highlight"><pre><code class="bash">export DELITE=[insert absolute path to Delite repo]
export LMS=[insert absolute path to LMS repo]</pre></code></div>
        <p>Get and compile <code>scala-virtualized</code> compiler that will be used to compile Delite framework and apps.
If you have troubles compiling <code>scala-virtualized</code>, take a look at the instructions at <a href="source.html">"Building from source"</a> page:</p> 
        <div class="highlight"><pre><code class="bash">git clone https://github.com/TiarkRompf/scala-virtualized.git
cd scala-virtualized
ant fastdist
</code></pre></div>
        <p>Once <code>scala-virtualized</code> is built, edit $DELITE/delite.properties and $LMS/local.properties to point to its distribution (i.e. to the folder that contains /bin and /lib subfolders - if you built the compiler using the instructions above, the distribution will be located at dists/latest within scala-virtualized folder). Here is an example line to add in both of these files:
        <div class="highlight"><pre><code class="bash">scala.virtualized.home=/ppl/scala-virtualized/dists/latest</code></pre></div>
        <p>First, we need to compile the <code>virtualization-lms-core</code> library that Delite uses.        
        <div class="highlight"><pre><code class="bash">cd $LMS
sbt update
sbt publish-local
</code></pre></div>         
        <p>Now, compile the Delite compiler framework using</p>
        <div class="highlight"><pre><code class="bash">cd $DELITE
sbt update
sbt compile
</code></pre></div>
        <p>
        We also need to compile the Delite runtime separately (this is because it uses a normal Scala compiler instead of the virtualized one,
        and we haven't figured out how to use different compilers within the same SBT project yet).
        </p>
        <div class="highlight"><pre><code class="bash">cd runtime
sbt update
sbt compile
cd ..
</code></pre></div>
        <p>
        Now we are ready to get started. Let's write "hello world" in OptiML. 
        At the root of the Delite repo, open up a file called 'HelloWorld.scala' and copy this text in:
        </p>
        <div class="highlight"><pre><code class="scala"><span class="k">import</span> <span class="nn">ppl.dsl.optiml._</span>
<span class="k">object</span> <span class="nc">HelloWorldRunner</span> <span class="k">extends</span> <span class="nc">OptiMLApplicationRunner</span> <span class="k">with</span> <span class="nc">HelloWorld</span> 
<span class="k">trait</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">OptiMLApplication</span> <span class="o">{</span> 
  <span class="k">def</span> <span class="n">main() = println("</span><span class="s">hello world</span><span class="n">")</span>
<span class="o">}</span>
</pre></code></div>
        <p>
        All Delite applications have three phases: compiling (Scala), staging (DSL compilation), and executing (runtime). The first step, running the scala compiler,
        checks your application for syntactic and type correctness. Staging is where the main compilation happens: the DSL builds an IR of the program, optimizes it,
        and generates an execution graph along with code for multiple targets (e.g. Scala and CUDA). Finally, the Delite runtime reads in the execution graph and
        generated kernels and executes the application.      
        </p>
        <p>
        So without further ado, let's get to it. Home directory of Delite has the <code>scripts</code> subdirectory that hosts several helpers scripts that we're going to use. Comprehensive documentation, which includes exact format of the command line and a list of configuration options, is available <a href="https://github.com/stanford-ppl/Delite/tree/develop/scripts">at Github</a>, but here we'll just illustrate a basic use case.
        </p> 
        <p>
        First things first - we compile our application with <code>delitec</code>. This combines the first two phases of Delite application's lifecycle: first, the app gets compiled by virtualized scala, then it gets staged by running the main method of <code>OptiMLApplicationRunner</code> object we just created.:
        <div class="highlight"><pre><code class="bash">delitec -Xrunner:HelloWorldRunner HelloWorld.scala</code></pre></div>
        </p>
        <p>
        You can also omit the <code>-Xrunner:HelloWorldRunner</code> part of the invocation, since <code>delitec</code> is smart enough to infer the location of the single runner in your application. However, if there are multiple runners and in some other cases <code>delitec</code> will get confused, and you'll have to resort to using <code>-Xrunner</code> again (see <a href="https://github.com/stanford-ppl/Delite/tree/develop/scripts">the docs</a> for more information about that):
        <div class="highlight"><pre><code class="bash">delitec HelloWorld.scala</code></pre></div>
        </p>
        <p>
        The generated execution graph will be in 'out.deg'. Also look around in the folder 'generated/' - it contains code OptiML generated!
        Note that you can specify a different file for the DEG by supplying the JVM parameter <code>delite.deg.filename</code>:
        <div class="highlight"><pre><code class="bash">delitec -Ddelite.deg.filename="hello.deg" HelloWorld.scala</code></pre></div>
        </p>
        <p>
        The last thing we need to do is execute our generated program (phase three). To do this, we invoke the Delite runtime using:</p><p>
        <div class="highlight"><pre><code class="bash">delite out.deg</code></pre></div>
        </p>
        <p>
        Similarly to <code>delitec</code>, Delite runtime script allows you to omit its arguments. If your current directory contains a single DEG file, you may leave it out when invoking <code>delite</code> (see <a href="https://github.com/stanford-ppl/Delite/tree/develop/scripts">the docs</a> for more information about this shortcut):</p><p>
        <div class="highlight"><pre><code class="bash">delite</code></pre></div>
        </p>
        <p>
        You should see output like the following:
        <div class="highlight"><pre><code class="bash">Delite Runtime executing with the following arguments:
out.deg
Delite Runtime executing with 1 CPU thread(s) and 0 GPU(s)
Beginning Execution Run 1
hello world
[METRICS]: Latest time for component all: 0.032000s
</code></pre></div>
      </p>
      <p>
      Congratulations! You just ran your first Delite application. Take some time to look at the generated DEG file, and the generated
      kernels inside generated/ to see what went on behind the scenes. When you think you're ready to really dive in, move on
      to <a href="dsl_example.html">building your own DSL</a>.
      </p>
      </div>
      <div id='footer'>Copyright &copy; 2011</div>
    </div>
  </body>
</html>
