<html>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
    <title>Delite &mdash; Getting started</title>
    <style type='text/css'>
      @import 'css/default.css';
      @import 'css/syntax.css';
    </style>
    <style media='print' type='text/css'>
      @import 'css/print.css';
    </style>
    <meta content='Delite documentation' name='subject'>
    <!-- <link href='images/favicon.png' rel='shortcut icon'> -->
  </head>
  <body>
    <div id='outer'>
      <div id='header'>
        <div class='home'><a href='http://stanford-ppl.github.com/delite/' title="Delite">Delite</a></div>
      </div>
      <div id='menu'>
        <ol>
          <li>Start Here
            <ol>
              <li><a href='index.html'>Welcome</a></li>
              <li><a href='getting_started.html'>Getting Started</a></li>
              <li><a href="dsl_example.html">My First DSL</a></li>
              <li><a href="performance.html">Performance</a></li>
              <li><a href="tests.html">Tests</a></li>
              <li><a href="troubleshooting.html">Troubleshooting</a></li>
              <li><a href="publications.html">Publications</a></li>
            </ol>
          </li>
          <li>Getting it
            <ol>
            <!--
              <li><a href='releases.html'>Releases</a></li>
              <li><a href='snapshots.html'>Snapshots</a></li>
            -->
              <li><a href='source.html'>Source</a></li>
              <li><a href='license.html'>License</a></li>
            </ol>
          </li>
          <!--
          <li>Reference
            <ol>
              <li><a href='api/0.3/index.html'>ScalaDoc API</a></li>
              <li>&nbsp;</li>
              <li><a href='sponsors.html'>Sponsors</a></li>
              <li class="logo"><a href="http://ppl.stanford.edu"><img width="110" alt="Stanford Pervasive Parallelism Lab" src='images/ppl_logo_small.png'></a></li>
            </ol>
          </li>
          -->
        </ol>
      </div>
      <div id='content'> 
        <h1 id='title_getting started'>Getting started</h1>
        <p> To get started, grab the source for <code>Delite</code> and <code>virtualization-lms-core</code>, the lightweight modular staging library
        that Delite uses. <p>
        <div class="highlight"><pre><code class="bash">git clone https://github.com/stanford-ppl/Delite.git
git clone https://github.com/TiarkRompf/virtualization-lms-core.git</code></pre></div>
        
        <p> The Delite repository currently includes several modules: </p>
        <ol>
          <li> <b>Applications:</b> these are example Delite applications written in a Delite DSL
          <li> <b>DSLs:</b> prototype Delite DSLs (the main one right now is OptiML)
          <li> <b>Framework:</b> The Delite Compiler Framework
          <li> <b>Runtime:</b> The Delite Runtime
          <li> <b>Tests:</b> tests for all Delite modules
        </ol>

        <p> For now, we'll get you up and running simple applications in the Delite environment so you can see what's going on.
        First, let's make sure that we are using the right branch. From the roots of the Delite repository and LMS repository <b>(note you have to check
          out the right branch in both repos)</b>, type
        <div class="highlight"><pre><code class="bash">git checkout stanford-cs442</code></pre></div>
        </p>       
        <p> If you are using IDEA, make sure that you have the <code>framework</code>, <code>dsls</code>, and
        <code>virtualization-lms-core</code> modules in your classpath. Also make sure that you are using
        the <code>scala-virtualized</code> compiler. You can download a pre-compiled distribution of <code>scala-virtualized</code>
        from <a href="http://www.stanford.edu/class/cs442/handouts/scala-virtualized-r24714.tgz">here</a>. The rest of this guide will assume a UNIX environment and
        use SBT and our shell scripts, but as long as IDEA is configured correctly, you should be able to follow along.
        See <a href="source.html">here</a> for detailed IDEA build instructions.
        </p>
        <p>If you haven't already, we need to compile Delite. We'll assume that the root directory
        of the Delite and LMS distributions you downloaded are <code>$DELITE</code> and <code>$LMS</code> respectively. Make sure that you have downloaded the
        <code>scala-virtualized</code> compiler, and then edit $DELITE/local.properties and $LMS/local.properties to point to the distribution. Here is an example:
        <div class="highlight"><pre><code class="bash">scala.virtualized.home=/ppl/scala-virtualized-r24714/</code></pre></div>
        <p>First, we need to compile the <code>virtualization-lms-core</code> library that Delite uses.
        <div class="highlight"><pre><code class="bash">cd $LMS
sbt update
sbt publish-local
</code></pre></div>         
        <p>Now, compile the Delite compiler framework using</p>
        <div class="highlight"><pre><code class="bash">cd $DELITE
sbt update
sbt compile
</code></pre></div>
        <p>
        We also need to compile the Delite runtime separately (this is because it uses a normal Scala compiler instead of the virtualized one,
        and we haven't figured out how to use different compilers within the same SBT project yet).
        </p>
        <div class="highlight"><pre><code class="bash">cd runtime
sbt update
sbt compile
cd ..
</code></pre></div>
        <p>
        Now we are ready to get started. Let's write "hello world" in OptiML. 
        At the root of the Delite repo, open up a file called 'HelloWorld.scala' and copy this text in:
        </p>
        <div class="highlight"><pre><code class="scala"><span class="k">import</span> <span class="nn">ppl.dsl.optiml._</span>
<span class="k">object</span> <span class="nc">HelloWorldRunner</span> <span class="k">extends</span> <span class="nc">OptiMLApplicationRunner</span> <span class="k">with</span> <span class="nc">HelloWorld</span> 
<span class="k">trait</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">OptiMLApplication</span> <span class="o">{</span> 
  <span class="k">def</span> <span class="n">main() = println("</span><span class="s">hello world</span><span class="n">")</span>
<span class="o">}</span>
</div>
        <p>
        All Delite applications have three phases: compiliing (Scala), staging (DSL compilation), and executing (runtime). The first step, running the scala compiler,
        checks your application for syntactic and type correctness. Staging is where the main compilation happens: the DSL builds an IR of the program, optimizes it,
        and generates an execution graph along with code for multiple targets (e.g. Scala and CUDA). Finally, the Delite runtime reads in the execution graph and
        generated kernels and executes the application.      
        </p>
        <p>
        So without further ado, let's get to it. First, we need to configure our classpath:
        <div class="highlight" style="overflow: scroll"><pre><code class="bash">export CLASSPATH=$CLASSPATH:dsls/optiml/target/scala_2.9.x-virtualized-SNAPSHOT/classes/:framework/target/scala_2.9.x-virtualized-SNAPSHOT/classes:$LMS/target/scala_2.9.x-virtualized-SNAPSHOT/classes:.</code></pre></div> 
        </p>
        <p>
        Assuming that the <code>scalac</code> in your path is from scala-virtualized, run
        <div class="highlight"><pre><code class="bash">scalac HelloWorld.scala</code></pre></div>
        </p>
        <p>
        Now we need to stage our program. We do this by running the main method of <code>OptiMLApplicationRunner</code> object we just created:
        <div class="highlight"><pre><code class="bash">scala HelloWorldRunner</code</pre></div>
        <p>
        The generated execution graph will be in 'out.deg'. Also look around in the folder 'generated/' - it contains code OptiML generated!
        Note that you can specify a different file for the DEG by supplying the JVM parameter <code>delite.deg.filename</code>:
        <div class="highlight"><pre><code class="bash">scala -Ddelite.deg.filename="hello.deg" HelloWorldRunner</code></pre></div>
        </p>
        <p>
        The last thing we need to do is execute our generated program. To do this, we are going to switch back to the normal Scala
        compiler (this is not strictly necessary, but tends to be more reliable). Download a current final version of <a href="http://www.scala-lang.org/downloads">Scala</a>. 
        We'll assume that $SCALA_VANILLA points to the root directory of the Scala distribution you just downloaded.
        Make sure fsc is running: 
        <div class="highlight"><pre><code class="bash">$SCALA_VANILLA/bin/fsc -reset</code></pre></div>
        Then invoke the Delite runtime using:
        <div class="highlight" style="overflow: scroll"><pre><code class="bash">java -cp runtime/target/scala_2.8.1/classes:$SCALA_VANILLA/lib/scala-library.jar:$SCALA_VANILLA/lib/scala-compiler.jar ppl.delite.runtime.Delite out.deg</code></pre></div>
        </p>
        <p>
        You should see output like the following:
        <div class="highlight"><pre>
Delite Runtime executing with the following arguments:
out.deg
Delite Runtime executing with 1 CPU thread(s) and 0 GPU(s)
Beginning Execution Run 1
hello world
[METRICS]: Latest time for component all: 0.032000s
</pre></div>
      </p>
      <p>
      Congratulations! You just ran your first Delite application. Take some time to look at the generated DEG file, and the generated
      kernels inside generated/ to see what went on behind the scenes. When you think you're ready to really dive in, move on
      to <a href="dsl_example.html">building your own DSL</a>.
      </p>
      </div>
      <div id='footer'>Copyright &copy; 2011</div>
    </div>
  </body>
</html>
