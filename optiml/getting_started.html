<html>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
    <title>OptiML &mdash; Getting started</title>
    <style type='text/css'>
      @import '../css/default.css';
      @import '../css/syntax.css';
    </style>
    <style media='print' type='text/css'>
      @import '../css/print.css';
    </style>
    <meta content='Delite documentation' name='subject'>
    <!-- <link href='images/favicon.png' rel='shortcut icon'> -->
  </head>
  <body>
    <div id='outer'>
      <div id='header'>
        <div class='home'><a href='http://stanford-ppl.github.com/Delite/optiml/' title="OptiML">OptiML</a></div>
      </div>
      <div id='menu'>
        <ol>
          <li>Start Here
            <ol>
              <li><a href='index.html'>Welcome</a></li>
              <li><a href='getting_started.html'>Getting Started</a></li>
              <!--<li><a href="faq.html">FAQ</a></li>-->
              <!--<li><a href="examples.html">Examples</a></li>-->
              <li><a href="debugging.html">Debugging</a></li>
              <li><a href="getting_started_native.html">Native Libraries and CUDA</a></li>
              <li><a href="http://groups.google.com/group/optiml">Mailing List</a></li>
              <li><a href="downloads/optiml-spec-0.1.pdf">Language Specification</a></li>
              <li><a href='http://stanford-ppl.github.com/Delite/index.html'>Delite</a></li>
            </ol>
          </li> 
          <!--
          <li>Reference
            <ol>
              <li><a href='api/0.3/index.html'>ScalaDoc API</a></li>
              <li>&nbsp;</li>
              <li><a href='sponsors.html'>Sponsors</a></li>
              <li class="logo"><a href="http://ppl.stanford.edu"><img width="110" alt="Stanford Pervasive Parallelism Lab" src='images/ppl_logo_small.png'></a></li>
            </ol>
          </li>
          -->
        </ol>
      </div>
      <div id='content'> 
        <h1 id='title_getting started'>Getting started</h1>
        <p style="font-size: 10pt"> The following instructions are for the Unix and OSX platforms. Windows support is coming soon.</p>

        <p> Delite requires <a href="http://java.com">Java 1.6 or later</a>, <a href="http://python.org">Python 2.6</a>, <a href="http://git-scm.com">git</a> and <a href="https://github.com/harrah/xsbt/wiki">SBT 0.11.3</a>. Instructions for installing
        these can be found at their respective websites.</p>
        <br>
        <div id="warn">
          <p> Delite currently requires a pre-release version of <a href="/Delite/dists/sbt/0.12.0-Beta2/sbt-launch.jar">sbt.</a> 
          <br><br>Download this jar and place it in an executable location, e.g. <code>~/bin/</code>. As with other versions of sbt, you will also need a simple shell script to run the jar. Create an executable script named 'sbt' in the same directory, containing the following line (our recommended parameters for running Delite):
          <br><br>
          <code>java -Xmx2g -XX:MaxPermSize=1g -XX:ReservedCodeCacheSize=128m -jar `dirname $0`/sbt-launch.jar "$@"</code>
          <br><br>
          If you have installed Delite before and are upgrading, you will need to run the command: 
          <br><br><code>sbt "reboot full"</code><br><br>
          from the LMS home directory before continuing the rest of the guide.
          </p>
        </div>
       
      <p>To get started, you first need to
        download the source for <code>Delite</code> and <code>virtualization-lms-core</code>, the lightweight modular
        staging library that Delite uses. Delite uses <a href="http://git-scm.com/">git</a> for version control (see <a href="http://book.git-scm.com/2_installing_git.html">here</a> for installation instructions).</p>
      <p>
        First, make a copy of the repository on your machine:
        </p><p>
        <div class="highlight"><pre><code class="bash">git clone git://github.com/stanford-ppl/Delite.git
git clone git://github.com/TiarkRompf/virtualization-lms-core.git</code></pre></div> 
        
        <p>Next, we need to compile LMS so Delite can use it. From the same directory where we ran <code>git clone</code>, type </p> 
        <div class="highlight"><pre><code class="bash">cd virtualization-lms-core
git checkout optiml-beta
sbt publish-local
</code></pre></div>

        <p> Now we are ready to compile and run Delite. Navigate back to the Delite directory and checkout the correct branch: </p>
<div class="highlight"><pre><code class="bash">cd ../Delite
git checkout optiml-beta
sbt clean
</code></pre></div>

        <p> The Delite repository currently includes several modules: </p>
        <ol>
          <li> <b>Applications:</b> these are example Delite applications written in a Delite DSL
          <li> <b>DSLs:</b> prototype Delite DSLs (the main one right now is OptiML)
          <li> <b>Framework:</b> The Delite Compiler Framework
          <li> <b>Runtime:</b> The Delite Runtime
          <li> <b>Tests:</b> tests for all Delite modules
        </ol>

        <p> For now, we'll get you up and running simple applications in the Delite environment so you can see what's going on.
        If you are using IDEA, make sure that you have the <code>framework</code>, <code>dsls</code>, and
        <code>virtualization-lms-core</code> modules in your classpath. Also make sure that you are using
        the <code>scala-virtualized</code> compiler. The rest of this guide will assume a UNIX/bash environment and
        use SBT and our shell scripts, but as long as IDEA is configured correctly, you should be able to follow along.
        See <a href="source.html">here</a> for detailed IDEA build instructions.
        </p>
       <p>The easiest way to compile Delite and OptiML is to use Delite's build scripts. From the Delite root directory, they can be added to your path as follows: <p>
<div class="highlight"><pre><code class="bash"> export PATH=$PATH:$PWD/bin</code></pre></div>

        <p> Delite scripts require the JAVA_HOME environment variable to be set. If it is not already, you will need to set it: </p>
<div class="highlight"><pre><code class="bash">export JAVA_HOME=[absolute path of Java installation] </code></pre></div> 

        <p> We are all set to compile Delite and OptiML. This can be done simply by running thei following script, which simply uses SBT to compile the required projects. </p>
<div class="highlight"><pre><code class="bash">build-optiml</code></pre></div> 

        <p>
        Now we are ready to write "hello world" in OptiML. Existing OptiML applications are located in the <code>apps/optiml/src</code> directory from the root of the Delite repository. It is
        easiest to add your application here, but you can add it anywhere you want as long as you update the SBT configuration to point to your new location. For now, let's open up a file
        in <code>apps/optiml/src</code> called 'HelloWorld.scala' and copy this text in:
        </p>
        <div class="highlight"><pre><code class="scala"><span class="k">import</span> <span class="nn">ppl.dsl.optiml._</span>
<span class="k">object</span> <span class="nc">HelloWorldRunner</span> <span class="k">extends</span> <span class="nc">OptiMLApplicationRunner</span> <span class="k">with</span> <span class="nc">HelloWorld</span> 
<span class="k">trait</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">OptiMLApplication</span> <span class="o">{</span> 
  <span class="k">def</span> <span class="n">main() = println("</span><span class="s">hello world</span><span class="n">")</span>
<span class="o">}</span>
</pre></code></div>
        <p>
        All Delite applications have three phases: compiling (Scala), staging (DSL compilation), and executing (runtime). The first step, running the scala compiler,
        checks your application for syntactic and type correctness. Staging is where the main compilation happens: the DSL builds an IR of the program, optimizes it,
        and generates an execution graph along with code for multiple targets (e.g. Scala and CUDA). Finally, the Delite runtime reads in the execution graph and
        generated kernels and executes the application.      
        </p>
        <p>
        So without further ado, let's get to it. Starting from the root of the Delite repository, first compile using SBT (alternative, just run <code>build-optiml</code> again):
        </p>
<div class="highlight"><pre><code class="bash">sbt "; project optiml-apps; compile"</code></pre></div> 
        <p>
        Next, we need to stage the application. We do this using the <code>delitec</code> script, where the argument to the script is the name of the <code>Runner</code> object that defines our application. Note that our <code>HelloWorld</code> application does not have a package, but if it does, we would need to include that. For example, to run the GDA application in OptiML, we would use <code>ppl.apps.ml.GDARunner</code>.  Of course, there is no magic here (it is just a Python script - look inside if you are interested in seeing what's happening).
        </p>
<div class="highlight"><pre><code class="bash">delitec HelloWorldRunner</code></pre></div> 
        <p>The generated execution graph will be in 'HelloWorldRunner.deg'. Also look around in the folder 'generated/' - it contains code OptiML generated!</p>
        <p>The last thing we need to do is execute our generated program (phase three). To do this, we invoke the Delite runtime using:</p><p>
        <div class="highlight"><pre><code class="bash">delite HelloWorldRunner</code></pre></div>
        </p>
        <p>
        You should see output like the following:
        <div class="highlight"><pre><code class="bash">Delite Runtime executing with the following arguments:
HelloWorldRunner.deg
Delite Runtime executing with 1 CPU thread(s) and 0 GPU(s)
Beginning Execution Run 1
hello world
[METRICS]: Latest time for component all: 0.032000s
</code></pre></div>
      </p>
      <p>
      Congratulations! You just ran your first OptiML application. Take some time to look at the generated DEG file, and the generated
      kernels inside generated/ to see what went on behind the scenes.</p>

	  <p> Delite is capable of using CUDA to execute applications on the GPU as well as BLAS to accelerate certain matrix operations on the CPU.  These features require some additional setup in order to work with your environment. <a href="getting_started_native.html"> Click here for instructions.</a> </p>
      </div>
      <div id='footer'>Copyright &copy; 2011</div>
    </div>
  </body>
</html>
