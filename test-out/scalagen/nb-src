/*****************************************
  Emitting Generated Code                  
*******************************************/
class Application extends ((Array[java.lang.String])=>(Unit)) {
def apply(x0:Array[java.lang.String]): Unit = {
val x1 = println("Naive Bayes Example Application")
val x2 = x0.length
val x3 = x2 < 2
val x7 = {
def x7thenb(): Nothing = {
val x4 = println("NaiveBayes <training file> <test file>")
val x5 = exit(-1)
x5
}
def x7elseb(): Unit = {
()
}
if (x3) {
x7thenb()
} else {
x7elseb()
}
}
val x8 = x0(0)
def x131_block = { 
val x10 = new java.io.FileReader(x8)
val x11 = new java.io.BufferedReader(x10)
var x12 = x11
val x13 = x12
val x14 = x13.readLine()
var x15 = x14
val x16 = x12
val x17 = x16.readLine()
var x18 = x17
val x19 = x18
val x20 = x19.trim()
val x21 = x20.split("\\s+")
val x22 = x21(0)
val x23 = java.lang.Integer.parseInt(x22)
val x26 = x23 < 0
val x24 = x21(1)
val x25 = java.lang.Integer.parseInt(x24)
val x27 = x25 < 0
val x28 = x26 || x27
val x31 = {
def x31thenb(): Nothing = {
val x29 = error("Illegal input to readTokenMatrix")
x29
}
def x31elseb(): Unit = {
()
}
if (x28) {
x31thenb()
} else {
x31elseb()
}
}
val x32 = x12
val x33 = x32.readLine()
val x34 = new generated.scala.DoubleVectorImpl(0,true)
var x36 : Int = 0
val x50 = while (x36 < x23) {
val x37 = x12
val x38 = x37.readLine()
x18 = x38
val x40 = x18
val x41 = x40.trim()
x18 = x41
val x43 = x18
val x47 = x34.length
val x44 = x43.split("\\s+")
val x45 = x44(0)
val x46 = java.lang.Double.parseDouble(x45)
val x48 = x34.insert(x47, x46)
x48
x36 = x36 + 1
}
val x51 = x34.length
val x52 = x34.isRow
val x53 = !x52
val x59 = {
val x55 = new generated.scala.DoubleVectorImpl(x51,x53)
x55
}
var x54 = 0
while (x54 < x51) {  // begin thin loop x59
val x57 = x34(x54)
x59.dcUpdate(x54, x57)
x54 += 1
} // end thin loop x59
val x60 = x12
val x61 = x60.close()
val x62 = new java.io.FileReader(x8)
val x63 = new java.io.BufferedReader(x62)
x12 = x63
val x65 = x12
val x66 = x65.readLine()
val x67 = x12
val x68 = x67.readLine()
val x69 = x12
val x70 = x69.readLine()
val x71 = new generated.scala.VectorImpl[generated.scala.Vector[Double]](0,true)
var x72 : Int = 0
val x105 = while (x72 < x23) {
val x73 = x12
val x74 = x73.readLine()
x18 = x74
val x76 = x18
val x77 = x76.trim()
x18 = x77
val x79 = x18
val x81 = new generated.scala.DoubleVectorImpl(x25,true)
var x82 = 0
var x83 = 1
val x80 = x79.split("\\s+")
val x85 = x80.length
val x86 = x85 - 1
val x101 = while ({val x84 = x83
val x87 = x84 < x86
x87}) {
val x89 = x83
val x90 = x80(x89)
val x91 = java.lang.Integer.parseInt(x90)
val x92 = x82 += x91
val x93 = x82
val x94 = x83
val x95 = x94 + 1
val x96 = x80(x95)
val x97 = java.lang.Double.parseDouble(x96)
val x98 = x81(x93) = x97
val x99 = x83 += 2
()
}
val x102 = x71.length
val x103 = x71.insert(x102, x81)
x103
x72 = x72 + 1
}
def x125_block = { 
val x106 = x71.length
val x107 = x106 > 0
val x111 = {
def x111thenb(): Int = {
val x108 = x71(0)
val x109 = x108.length
x109
}
def x111elseb(): Int = {
0
}
if (x107) {
x111thenb()
} else {
x111elseb()
}
}
val x112 = new generated.scala.DoubleMatrixImpl(x106,x111)
var x114 : Int = 0
val x123 = while (x114 < x106) {
var x116 : Int = 0
val x121 = while (x116 < x111) {
val x117 = x71(x114)
val x118 = x117(x116)
val x119 = x112(x114, x116) = x118
x119
x116 = x116 + 1
}
x121
x114 = x114 + 1
}
x112
}
val x125 = x125_block
val x126 = x12
val x127 = x126.close()
val x128 = new generated.scala.DoubleLabelsImpl(x59)
val x129 = new generated.scala.DoubleDoubleTrainingSetImpl(x125,x128)
x129
}
val x131 = x131_block
val x132 = println("tic:" + (System.nanoTime / 1000000L))
val x133 = x131.numRows
val x135 = new generated.scala.IndexVectorRangeImpl(0,x133)
val x134 = x131.numCols
val x146 = x135.length
val x147 = x135.isRow
def x150_block = {
val x148 = new generated.scala.DoubleVectorImpl(x146,x147)
var mapIdx = 0
while (mapIdx < x135.size) {
val x136 = x135.dcApply(mapIdx)
x148.dcUpdate(mapIdx,  {
var x145: Double = 0
var x140 = 0
while (x140 < x134) {  // begin fat loop x145
val x143 = x131(x136, x140)
val x141 = x145
val x142 = x143
val x144 = x141 + x142
x145 = x144
x140 += 1
} // end fat loop x145
x145
})
mapIdx += 1
} // end while
x148
}
val x150 = x150_block
val x151 = "Training model on "+x133
val x152 = x151+" documents."
val x153 = println(x152)
val x167 = new generated.scala.IndexVectorRangeImpl(0,x134)
val x154 = x131.labels
def x164_block = { 
val x162 = new generated.scala.DoubleVectorImpl(x134,true)
x162
}
val x164 = x164_block
val x202 = x134
def x215_block = {
var forIdx = 0
while (forIdx < x167.size) {
val x168 = x167.dcApply(forIdx)
var x169 = 0.0
var x170 = 0.0
var x171 = 0.0
var x172 = 0.0
var x173 = 0
val x198 = while ({val x174 = x173
val x175 = x174 < x133
x175}) {
val x177 = x173
val x178 = x154(x177)
val x179 = x178==1
val x195 = {
def x195thenb(): Unit = {
val x181 = x173
val x180 = x131.transposed
val x182 = x180(x168, x181)
val x183 = x169 += x182
val x184 = x173
val x185 = x150(x184)
val x186 = x170 += x185
()
}
def x195elseb(): Unit = {
val x188 = x173
val x180 = x131.transposed
val x189 = x180(x168, x188)
val x190 = x171 += x189
val x191 = x173
val x192 = x150(x191)
val x193 = x172 += x192
()
}
if (x179) {
x195thenb()
} else {
x195elseb()
}
}
val x196 = x173 += 1
()
}
val x199 = x169
val x201 = x170
val x200 = x199 + 1.0
val x203 = x201 + x202
val x204 = x200 / x203
val x205 = x164(x168) = x204
val x206 = x171
val x208 = x172
val x207 = x206 + 1.0
val x209 = x208 + x202
val x210 = x207 / x209
val x211 = x164(x168) = x210
x211
forIdx += 1
} // end while
}
val x215 = x215_block
val x218 = println("toc:" + (System.nanoTime / 1000000L))
val x9 = x0(1)
def x340_block = { 
val x219 = new java.io.FileReader(x9)
val x220 = new java.io.BufferedReader(x219)
var x221 = x220
val x222 = x221
val x223 = x222.readLine()
var x224 = x223
val x225 = x221
val x226 = x225.readLine()
var x227 = x226
val x228 = x227
val x229 = x228.trim()
val x230 = x229.split("\\s+")
val x231 = x230(0)
val x232 = java.lang.Integer.parseInt(x231)
val x235 = x232 < 0
val x233 = x230(1)
val x234 = java.lang.Integer.parseInt(x233)
val x236 = x234 < 0
val x237 = x235 || x236
val x240 = {
def x240thenb(): Nothing = {
val x238 = error("Illegal input to readTokenMatrix")
x238
}
def x240elseb(): Unit = {
()
}
if (x237) {
x240thenb()
} else {
x240elseb()
}
}
val x241 = x221
val x242 = x241.readLine()
val x243 = new generated.scala.DoubleVectorImpl(0,true)
var x245 : Int = 0
val x259 = while (x245 < x232) {
val x246 = x221
val x247 = x246.readLine()
x227 = x247
val x249 = x227
val x250 = x249.trim()
x227 = x250
val x252 = x227
val x256 = x243.length
val x253 = x252.split("\\s+")
val x254 = x253(0)
val x255 = java.lang.Double.parseDouble(x254)
val x257 = x243.insert(x256, x255)
x257
x245 = x245 + 1
}
val x260 = x243.length
val x261 = x243.isRow
val x262 = !x261
val x268 = {
val x264 = new generated.scala.DoubleVectorImpl(x260,x262)
x264
}
var x263 = 0
while (x263 < x260) {  // begin thin loop x268
val x266 = x243(x263)
x268.dcUpdate(x263, x266)
x263 += 1
} // end thin loop x268
val x269 = x221
val x270 = x269.close()
val x271 = new java.io.FileReader(x9)
val x272 = new java.io.BufferedReader(x271)
x221 = x272
val x274 = x221
val x275 = x274.readLine()
val x276 = x221
val x277 = x276.readLine()
val x278 = x221
val x279 = x278.readLine()
val x280 = new generated.scala.VectorImpl[generated.scala.Vector[Double]](0,true)
var x281 : Int = 0
val x314 = while (x281 < x232) {
val x282 = x221
val x283 = x282.readLine()
x227 = x283
val x285 = x227
val x286 = x285.trim()
x227 = x286
val x288 = x227
val x290 = new generated.scala.DoubleVectorImpl(x234,true)
var x291 = 0
var x292 = 1
val x289 = x288.split("\\s+")
val x294 = x289.length
val x295 = x294 - 1
val x310 = while ({val x293 = x292
val x296 = x293 < x295
x296}) {
val x298 = x292
val x299 = x289(x298)
val x300 = java.lang.Integer.parseInt(x299)
val x301 = x291 += x300
val x302 = x291
val x303 = x292
val x304 = x303 + 1
val x305 = x289(x304)
val x306 = java.lang.Double.parseDouble(x305)
val x307 = x290(x302) = x306
val x308 = x292 += 2
()
}
val x311 = x280.length
val x312 = x280.insert(x311, x290)
x312
x281 = x281 + 1
}
def x334_block = { 
val x315 = x280.length
val x316 = x315 > 0
val x320 = {
def x320thenb(): Int = {
val x317 = x280(0)
val x318 = x317.length
x318
}
def x320elseb(): Int = {
0
}
if (x316) {
x320thenb()
} else {
x320elseb()
}
}
val x321 = new generated.scala.DoubleMatrixImpl(x315,x320)
var x323 : Int = 0
val x332 = while (x323 < x315) {
var x325 : Int = 0
val x330 = while (x325 < x320) {
val x326 = x280(x323)
val x327 = x326(x325)
val x328 = x321(x323, x325) = x327
x328
x325 = x325 + 1
}
x330
x323 = x323 + 1
}
x321
}
val x334 = x334_block
val x335 = x221
val x336 = x335.close()
val x337 = new generated.scala.DoubleLabelsImpl(x268)
val x338 = new generated.scala.DoubleDoubleTrainingSetImpl(x334,x337)
x338
}
val x340 = x340_block
val x341 = println("phi_y1: ")
val x342 = x164.isRow
def x361_block = { 
val x359 = {
def x359thenb(): Unit = {
val x343 = print("[ ")
var x345 : Int = 0
val x349 = while (x345 < x134) {
val x346 = print(0)
val x347 = print(" ")
x347
x345 = x345 + 1
}
val x350 = print("]\n")
x350
}
def x359elseb(): Unit = {
var x352 : Int = 0
val x357 = while (x352 < x134) {
val x353 = print("[")
val x354 = print(0)
val x355 = print(" ]\n")
x355
x352 = x352 + 1
}
x357
}
if (x342) {
x359thenb()
} else {
x359elseb()
}
}
x359
}
val x361 = x361_block
val x362 = println("phi_y0: ")
def x380_block = { 
val x378 = {
def x378thenb(): Unit = {
val x363 = print("[ ")
var x364 : Int = 0
val x368 = while (x364 < x134) {
val x365 = print(0)
val x366 = print(" ")
x366
x364 = x364 + 1
}
val x369 = print("]\n")
x369
}
def x378elseb(): Unit = {
var x371 : Int = 0
val x376 = while (x371 < x134) {
val x372 = print("[")
val x373 = print(0)
val x374 = print(" ]\n")
x374
x371 = x371 + 1
}
x376
}
if (x342) {
x378thenb()
} else {
x378elseb()
}
}
x378
}
val x380 = x380_block
val x155 = x154.length
var x161: Double = 0
var x156 = 0
while (x156 < x155) {  // begin fat loop x161
val x159 = x154(x156)
val x157 = x161
val x158 = x159
val x160 = x157 + x158
x161 = x160
x156 += 1
} // end fat loop x161
val x216 = x133
val x217 = x161 / x216
val x381 = "phi_y: "+x217
val x382 = println(x381)
val x383 = x340.numRows
val x385 = "Testing model on "+x383
val x386 = x385+" documents."
val x387 = println(x386)
val x388 = new generated.scala.IndexVectorRangeImpl(0,x383)
val x384 = x340.numCols
val x407 = new generated.scala.RangeVectorImpl(0,x384,1,true)
val x423 = x388.length
val x424 = x388.isRow
def x427_block = {
val x425 = new generated.scala.DoubleVectorImpl(x423,x424)
var mapIdx = 0
while (mapIdx < x388.size) {
val x389 = x388.dcApply(mapIdx)
x425.dcUpdate(mapIdx,  {
def x417_block = {
val x390 = x407.dcApply(0)
var x408 = {
val x391 = x340(x389, x390)
val x392 = x391 > 0.0
val x405 = {
def x405thenb(): scala.Tuple2[Double, Double] = {
val x393 = Math.log(0)
val x394 = 1.0 - x217
val x395 = Math.log(x394)
val x398 = Math.log(0)
val x399 = Math.log(x217)
val x396 = x393 + x395
val x397 = x396 * x391
val x400 = x398 + x399
val x401 = x400 * x391
val x402 = (x397,x401)
x402
}
def x405elseb(): scala.Tuple2[Double, Double] = {
val x404 = (0.0,0.0)
x404
}
if (x392) {
x405thenb()
} else {
x405elseb()
}
}
x405
}
var mapReduceIdx = 1
while (mapReduceIdx < x407.size) {
val x390 = x407.dcApply(mapReduceIdx)
val x409 = {
val x391 = x340(x389, x390)
val x392 = x391 > 0.0
val x405 = {
def x405thenb(): scala.Tuple2[Double, Double] = {
val x393 = Math.log(0)
val x394 = 1.0 - x217
val x395 = Math.log(x394)
val x398 = Math.log(0)
val x399 = Math.log(x217)
val x396 = x393 + x395
val x397 = x396 * x391
val x400 = x398 + x399
val x401 = x400 * x391
val x402 = (x397,x401)
x402
}
def x405elseb(): scala.Tuple2[Double, Double] = {
val x404 = (0.0,0.0)
x404
}
if (x392) {
x405thenb()
} else {
x405elseb()
}
}
x405
}
x408 = {
val x410 = x408._1
val x412 = x409._1
val x414 = x410 + x412
val x411 = x408._2
val x413 = x409._2
val x415 = x411 + x413
val x416 = (x414,x415)
x416
}
mapReduceIdx += 1
} // end while
x408
}
val x417 = x417_block
val x418 = x417._1
val x419 = x417._2
val x420 = x419 > x418
val x421 = {
def x421thenb(): Double = {
1.0
}
def x421elseb(): Double = {
0.0
}
if (x420) {
x421thenb()
} else {
x421elseb()
}
}
x421
})
mapIdx += 1
} // end while
x425
}
val x427 = x427_block
var x428 = 0
val x431 = x340.labels
var x430 : Int = 0
val x439 = while (x430 < x383) {
val x432 = x431(x430)
val x433 = x427(x430)
val x434 = x432 != x433
val x437 = {
def x437thenb(): Unit = {
val x435 = x428 += 1
()
}
def x437elseb(): Unit = {
()
}
if (x434) {
x437thenb()
} else {
x437elseb()
}
}
x437
x430 = x430 + 1
}
val x440 = x428
val x441 = x440.doubleValue()
val x442 = x383.doubleValue()
val x443 = x441 / x442
val x444 = "Test error: "+x443
val x445 = println(x444)
()
}
}
/*****************************************
  End of Generated Code                  
*******************************************/
